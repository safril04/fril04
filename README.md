# fril04
#!/usr/bin/env bashset -o errexit -o pipefail [[ -z $DOMINO_USER_NAME ]] && DOMINO_USER_NAME="domino"[[ -z $DOMINO_WORKING_DIR ]] && DOMINO_WORKING_DIR="/mnt"[[ -z $DOMINO_PROJECT_OWNER ]] && DOMINO_PROJECT_OWNER="domino"[[ -z $DOMINO_PROJECT_NAME ]] && DOMINO_PROJECT_NAME="domino"[[ -z $DOMINO_RUN_ID ]] && DOMINO_RUN_ID="1"[[ -z $DOMINO_USER_HOST ]] && DOMINO_USER_HOST="http://localhost"[[ -z $DOMINO_USE_SUBDOMAIN ]] && DOMINO_USE_SUBDOMAIN=false[[ -z $SAS_LOGS_TO_DISK ]] && SAS_LOGS_TO_DISK=true[[ -z $REVERSE_PROXY_PORT ]] && REVERSE_PROXY_PORT=8888 DOMINO_SAS_CONFIG_DIR="${DOMINO_WORKING_DIR}/sasconfig"DOMINO_SASSTUDIO_AUTOEXEC_FILE="${DOMINO_SAS_CONFIG_DIR}/sasstudio-autoexec.sas"DOMINO_SAS_SNIPPETS_DIR="${DOMINO_SAS_CONFIG_DIR}/snippets"DOMINO_SAS_TASKS_DIR="${DOMINO_SAS_CONFIG_DIR}/tasks"DOMINO_SAS_PREFERENCES_DIR="${DOMINO_SAS_CONFIG_DIR}/preferences"DOMINO_SAS_KEYBOARDSHORTCUTS_DIR="${DOMINO_SAS_CONFIG_DIR}/keyboardShortcuts"DOMINO_SAS_STATE_DIR="${DOMINO_SAS_CONFIG_DIR}/state"DOMINO_GIT_REPOS_PATH=/reposDOMINO_DATASETS_PATH=/domino/datasetsSAS_STUDIO_CONFIG_FILE=/opt/sas/viya/config/etc/sasstudio/default/init_usermods.propertiesSAS_AUTOEXEC_DIR="$HOME/.sasstudio5"SAS_STUDIO_AUTOEXEC_FILE="${SAS_AUTOEXEC_DIR}/.autoexec.sas"SAS_SHORTCUTS_DIR="$HOME/.sasstudio5"SAS_SHORTCUTS_FILE="${SAS_SHORTCUTS_DIR}/shortcuts.xml"SAS_SNIPPETS_DIR="$HOME/.sasstudio5/mySnippets"SAS_TASKS_DIR="$HOME/.sasstudio5/myTasks"SAS_PREFERENCES_DIR="$HOME/.sasstudio5/preferences"SAS_KEYBOARDSHORTCUTS_DIR="$HOME/.sasstudio5/keyboardShortcuts"SAS_STATE_DIR="$HOME/.sasstudio5/state"SAS_JAVA_OPTIONS="-Dserver.servlet.session.timeout=-1" # Prevent SAS Entrypoint script from starting Apache proxy serverAPACHE_CONF=/etc/httpd/conf/httpd.confAPACHE_PORT=8880sudo sed -Ei "s#Listen 80#Listen $APACHE_PORT#g" $APACHE_CONF # Set up Domino project to preserve SAS configuration filesmkdir -p "$DOMINO_SAS_CONFIG_DIR" "$DOMINO_SAS_SNIPPETS_DIR" "$DOMINO_SAS_TASKS_DIR" "$DOMINO_SAS_PREFERENCES_DIR" "$DOMINO_SAS_KEYBOARDSHORTCUTS_DIR" "$DOMINO_SAS_STATE_DIR" # Hack to ensure autoexec.sas can live in the Domino project folder.# This is needed to properly tie in autoexec.sas with SAS Studiomkdir -p "$SAS_AUTOEXEC_DIR"rm -rf "$SAS_STUDIO_AUTOEXEC_FILE"ln -s "$DOMINO_SASSTUDIO_AUTOEXEC_FILE" "$SAS_STUDIO_AUTOEXEC_FILE" # Hack to ensure SAS Studio "My Snippets" are preserved with the Domino project filesrm -rf "$SAS_SNIPPETS_DIR"ln -s "$DOMINO_SAS_SNIPPETS_DIR" "$SAS_SNIPPETS_DIR" # Hack to ensure SAS Studio "My Tasks" are preserved with the Domino project filesrm -rf "$SAS_TASKS_DIR"ln -s "$DOMINO_SAS_TASKS_DIR" "$SAS_TASKS_DIR" # Hack to ensure SAS Studio Preferences are preserved with the Domino project files[[ ! -d "$DOMINO_SAS_STATE_DIR" && -d "$SAS_STATE_DIR" ]] && cp -r "${SAS_STATE_DIR}/*" "${DOMINO_SAS_STATE_DIR}/"rm -rf "$SAS_STATE_DIR"ln -s "$DOMINO_SAS_STATE_DIR" "$SAS_STATE_DIR" # Hack to ensure SAS Studio state is preserved with the Domino project files[[ ! -d "$DOMINO_SAS_PREFERENCES_DIR" && -d "$SAS_PREFERENCES_DIR" ]] && cp -r "${SAS_PREFERENCES_DIR}/*" "${DOMINO_SAS_PREFERENCES_DIR}/"rm -rf "$SAS_PREFERENCES_DIR"ln -s "$DOMINO_SAS_PREFERENCES_DIR" "$SAS_PREFERENCES_DIR" # Hack to ensure SAS Studio Keyboard Shortcuts are preserved with the Domino project filesrm -rf "$SAS_KEYBOARDSHORTCUTS_DIR"ln -s "$DOMINO_SAS_KEYBOARDSHORTCUTS_DIR" "$SAS_KEYBOARDSHORTCUTS_DIR" # Configure SAS Studio folder shortcuts to show Domino Git repos and Datasets foldersSHORTCUTS_DOMINO_GIT_REPOS=""if [ -d "$DOMINO_GIT_REPOS_PATH" ]; then SHORTCUTS_DOMINO_GIT_REPOS=" <Shortcut type=\"disk\" name=\"Git Repos\" dir=\"$DOMINO_GIT_REPOS_PATH\" />"fi SHORTCUTS_DOMINO_DATASETS=""if [ -d "$DOMINO_DATASETS_PATH" ]; then SHORTCUTS_DOMINO_DATASETS=" <Shortcut type=\"disk\" name=\"Domino Datasets\" dir=\"$DOMINO_DATASETS_PATH\" />"fi SHORTCUTS_DOMINO_IMPORTS=""for DOMINO_IMPORT in `printenv | grep -e 'DOMINO_.*_WORKING_DIR' | tr '=' ' ' | awk '{print $1}'`; do DOMINO_IMPORT_DIR=${!DOMINO_IMPORT} DOMIMO_IMPORT_NAME=`echo "Import $DOMINO_IMPORT_DIR" | sed 's#/mnt/##g'` SHORTCUTS_DOMINO_IMPORTS=" <Shortcut type=\"disk\" name=\"$DOMIMO_IMPORT_NAME\" dir=\"$DOMINO_IMPORT_DIR\" />"done SHORTCUTS_HOME=" <Shortcut type=\"disk\" name=\"Home\" dir=\"$HOME\" />"SHORTCUTS_TMP=" <Shortcut type=\"disk\" name=\"Temp\" dir=\"/tmp\" />" SAS_SHORTCUTS="""<?xml version=\"1.0\" encoding=\"UTF-8\"?><Shortcuts>$SHORTCUTS_DOMINO_GIT_REPOS$SHORTCUTS_DOMINO_DATASETS$SHORTCUTS_DOMINO_IMPORTS$SHORTCUTS_HOME$SHORTCUTS_TMP</Shortcuts>"""mkdir -p $SAS_SHORTCUTS_DIRecho $SAS_SHORTCUTS > $SAS_SHORTCUTS_FILE # Configure SAS Studio options for DominoSAS_CONFIG_UPDATES="""sas.studio.basicUser=dominosas.studio.basicPassword=dominosas.studio.fileNavigationRoot=CUSTOMsas.studio.fileNavigationCustomRootPath=${DOMINO_WORKING_DIR}sas.studio.globalShortcutsPath=${SAS_SHORTCUTS_FILE}sas.commons.web.security.cors.allowedOrigins=*sas.commons.web.security.csrf.enable-csrf=falsesas.commons.web.security.content-security-policy-enabled=falsesas.commons.web.security.x-frame-options-enabled=falsesas.commons.web.security.x-content-type-options-enabled=falsesas.commons.web.security.x-xss-protection-enabled=false"""sudo sh -c "echo '$SAS_CONFIG_UPDATES' > $SAS_STUDIO_CONFIG_FILE" # Some configuration for Domino subdomains and revese proxy serverif $DOMINO_USE_SUBDOMAIN; then PREFIX="/SASStudio/" else PREFIX="/${DOMINO_PROJECT_OWNER}/${DOMINO_PROJECT_NAME}/notebookSession/${DOMINO_RUN_ID}/" SAS_JAVA_OPTIONS="$SAS_JAVA_OPTIONS -Dserver.servlet.context-path=$PREFIX"fiSAS_TEST_URL="http://localhost:7080${PREFIX}"DOMINO_SAS_ENTRY_PAGE="${PREFIX}start.html"sudo mkdir -p ${SASDS_SCRIPT_DIR}/html${PREFIX}sudo chown -R $DOMINO_USER_NAME:$DOMINO_USER_NAME ${SASDS_SCRIPT_DIR}/html${PREFIX}sudo sed -Ei "s#8888#$REVERSE_PROXY_PORT#g" ${SASDS_SCRIPT_DIR}/nginx.confsudo sed -E "s#SESSION_PATH#$PREFIX#g" ${SASDS_SCRIPT_DIR}/start.html > ${SASDS_SCRIPT_DIR}/html${DOMINO_SAS_ENTRY_PAGE} # This actually starts the SAS Studio workspacesudo -E SAS_LOGS_TO_DISK=$SAS_LOGS_TO_DISK _JAVA_OPTIONS="$_JAVA_OPTIONS $SAS_JAVA_OPTIONS" bash -c '/opt/sas/viya/home/bin/entrypoint &' # Wait for SAS Studio web server to come onlineuntil $(curl --output /dev/null --silent --head --fail $SAS_TEST_URL); do sleep 3; done # Start reverse proxy serversudo /usr/sbin/nginx -c ${SASDS_SCRIPT_DIR}/nginx.confecho -e "\n\nSAS Studio is now running\nTo get started, please visit ${DOMINO_USER_HOST}${DOMINO_SAS_ENTRY_PAGE} in your web browser.\n\n" # Infinite loop to prevent Workspace container from terminatingwhile true; do :; done;

Â© 2020 GitHub, Inc.TermsPrivacySecurityStatusHelpContact GitHubPricingAPITrainingBlogAbout


#!/usr/bin/env bashset -o errexit -o pipefail [[ -z $DOMINO_USER_NAME ]] && DOMINO_USER_NAME="domino"[[ -z $DOMINO_WORKING_DIR ]] && DOMINO_WORKING_DIR="/mnt"[[ -z $DOMINO_PROJECT_OWNER ]] && DOMINO_PROJECT_OWNER="domino"[[ -z $DOMINO_PROJECT_NAME ]] && DOMINO_PROJECT_NAME="domino"[[ -z $DOMINO_RUN_ID ]] && DOMINO_RUN_ID="1"[[ -z $DOMINO_USER_HOST ]] && DOMINO_USER_HOST="http://localhost"[[ -z $DOMINO_USE_SUBDOMAIN ]] && DOMINO_USE_SUBDOMAIN=false[[ -z $SAS_LOGS_TO_DISK ]] && SAS_LOGS_TO_DISK=true[[ -z $REVERSE_PROXY_PORT ]] && REVERSE_PROXY_PORT=8888 DOMINO_SAS_CONFIG_DIR="${DOMINO_WORKING_DIR}/sasconfig"DOMINO_SASSTUDIO_AUTOEXEC_FILE="${DOMINO_SAS_CONFIG_DIR}/sasstudio-autoexec.sas"DOMINO_SAS_SNIPPETS_DIR="${DOMINO_SAS_CONFIG_DIR}/snippets"DOMINO_SAS_TASKS_DIR="${DOMINO_SAS_CONFIG_DIR}/tasks"DOMINO_SAS_PREFERENCES_DIR="${DOMINO_SAS_CONFIG_DIR}/preferences"DOMINO_SAS_KEYBOARDSHORTCUTS_DIR="${DOMINO_SAS_CONFIG_DIR}/keyboardShortcuts"DOMINO_SAS_STATE_DIR="${DOMINO_SAS_CONFIG_DIR}/state"DOMINO_GIT_REPOS_PATH=/reposDOMINO_DATASETS_PATH=/domino/datasetsSAS_STUDIO_CONFIG_FILE=/opt/sas/viya/config/etc/sasstudio/default/init_usermods.propertiesSAS_AUTOEXEC_DIR="$HOME/.sasstudio5"SAS_STUDIO_AUTOEXEC_FILE="${SAS_AUTOEXEC_DIR}/.autoexec.sas"SAS_SHORTCUTS_DIR="$HOME/.sasstudio5"SAS_SHORTCUTS_FILE="${SAS_SHORTCUTS_DIR}/shortcuts.xml"SAS_SNIPPETS_DIR="$HOME/.sasstudio5/mySnippets"SAS_TASKS_DIR="$HOME/.sasstudio5/myTasks"SAS_PREFERENCES_DIR="$HOME/.sasstudio5/preferences"SAS_KEYBOARDSHORTCUTS_DIR="$HOME/.sasstudio5/keyboardShortcuts"SAS_STATE_DIR="$HOME/.sasstudio5/state"SAS_JAVA_OPTIONS="-Dserver.servlet.session.timeout=-1" # Prevent SAS Entrypoint script from starting Apache proxy serverAPACHE_CONF=/etc/httpd/conf/httpd.confAPACHE_PORT=8880sudo sed -Ei "s#Listen 80#Listen $APACHE_PORT#g" $APACHE_CONF # Set up Domino project to preserve SAS configuration filesmkdir -p "$DOMINO_SAS_CONFIG_DIR" "$DOMINO_SAS_SNIPPETS_DIR" "$DOMINO_SAS_TASKS_DIR" "$DOMINO_SAS_PREFERENCES_DIR" "$DOMINO_SAS_KEYBOARDSHORTCUTS_DIR" "$DOMINO_SAS_STATE_DIR" # Hack to ensure autoexec.sas can live in the Domino project folder.# This is needed to properly tie in autoexec.sas with SAS Studiomkdir -p "$SAS_AUTOEXEC_DIR"rm -rf "$SAS_STUDIO_AUTOEXEC_FILE"ln -s "$DOMINO_SASSTUDIO_AUTOEXEC_FILE" "$SAS_STUDIO_AUTOEXEC_FILE" # Hack to ensure SAS Studio "My Snippets" are preserved with the Domino project filesrm -rf "$SAS_SNIPPETS_DIR"ln -s "$DOMINO_SAS_SNIPPETS_DIR" "$SAS_SNIPPETS_DIR" # Hack to ensure SAS Studio "My Tasks" are preserved with the Domino project filesrm -rf "$SAS_TASKS_DIR"ln -s "$DOMINO_SAS_TASKS_DIR" "$SAS_TASKS_DIR" # Hack to ensure SAS Studio Preferences are preserved with the Domino project files[[ ! -d "$DOMINO_SAS_STATE_DIR" && -d "$SAS_STATE_DIR" ]] && cp -r "${SAS_STATE_DIR}/*" "${DOMINO_SAS_STATE_DIR}/"rm -rf "$SAS_STATE_DIR"ln -s "$DOMINO_SAS_STATE_DIR" "$SAS_STATE_DIR" # Hack to ensure SAS Studio state is preserved with the Domino project files[[ ! -d "$DOMINO_SAS_PREFERENCES_DIR" && -d "$SAS_PREFERENCES_DIR" ]] && cp -r "${SAS_PREFERENCES_DIR}/*" "${DOMINO_SAS_PREFERENCES_DIR}/"rm -rf "$SAS_PREFERENCES_DIR"ln -s "$DOMINO_SAS_PREFERENCES_DIR" "$SAS_PREFERENCES_DIR" # Hack to ensure SAS Studio Keyboard Shortcuts are preserved with the Domino project filesrm -rf "$SAS_KEYBOARDSHORTCUTS_DIR"ln -s "$DOMINO_SAS_KEYBOARDSHORTCUTS_DIR" "$SAS_KEYBOARDSHORTCUTS_DIR" # Configure SAS Studio folder shortcuts to show Domino Git repos and Datasets foldersSHORTCUTS_DOMINO_GIT_REPOS=""if [ -d "$DOMINO_GIT_REPOS_PATH" ]; then SHORTCUTS_DOMINO_GIT_REPOS=" <Shortcut type=\"disk\" name=\"Git Repos\" dir=\"$DOMINO_GIT_REPOS_PATH\" />"fi SHORTCUTS_DOMINO_DATASETS=""if [ -d "$DOMINO_DATASETS_PATH" ]; then SHORTCUTS_DOMINO_DATASETS=" <Shortcut type=\"disk\" name=\"Domino Datasets\" dir=\"$DOMINO_DATASETS_PATH\" />"fi SHORTCUTS_DOMINO_IMPORTS=""for DOMINO_IMPORT in `printenv | grep -e 'DOMINO_.*_WORKING_DIR' | tr '=' ' ' | awk '{print $1}'`; do DOMINO_IMPORT_DIR=${!DOMINO_IMPORT} DOMIMO_IMPORT_NAME=`echo "Import $DOMINO_IMPORT_DIR" | sed 's#/mnt/##g'` SHORTCUTS_DOMINO_IMPORTS=" <Shortcut type=\"disk\" name=\"$DOMIMO_IMPORT_NAME\" dir=\"$DOMINO_IMPORT_DIR\" />"done SHORTCUTS_HOME=" <Shortcut type=\"disk\" name=\"Home\" dir=\"$HOME\" />"SHORTCUTS_TMP=" <Shortcut type=\"disk\" name=\"Temp\" dir=\"/tmp\" />" SAS_SHORTCUTS="""<?xml version=\"1.0\" encoding=\"UTF-8\"?><Shortcuts>$SHORTCUTS_DOMINO_GIT_REPOS$SHORTCUTS_DOMINO_DATASETS$SHORTCUTS_DOMINO_IMPORTS$SHORTCUTS_HOME$SHORTCUTS_TMP</Shortcuts>"""mkdir -p $SAS_SHORTCUTS_DIRecho $SAS_SHORTCUTS > $SAS_SHORTCUTS_FILE # Configure SAS Studio options for DominoSAS_CONFIG_UPDATES="""sas.studio.basicUser=dominosas.studio.basicPassword=dominosas.studio.fileNavigationRoot=CUSTOMsas.studio.fileNavigationCustomRootPath=${DOMINO_WORKING_DIR}sas.studio.globalShortcutsPath=${SAS_SHORTCUTS_FILE}sas.commons.web.security.cors.allowedOrigins=*sas.commons.web.security.csrf.enable-csrf=falsesas.commons.web.security.content-security-policy-enabled=falsesas.commons.web.security.x-frame-options-enabled=falsesas.commons.web.security.x-content-type-options-enabled=falsesas.commons.web.security.x-xss-protection-enabled=false"""sudo sh -c "echo '$SAS_CONFIG_UPDATES' > $SAS_STUDIO_CONFIG_FILE" # Some configuration for Domino subdomains and revese proxy serverif $DOMINO_USE_SUBDOMAIN; then PREFIX="/SASStudio/" else PREFIX="/${DOMINO_PROJECT_OWNER}/${DOMINO_PROJECT_NAME}/notebookSession/${DOMINO_RUN_ID}/" SAS_JAVA_OPTIONS="$SAS_JAVA_OPTIONS -Dserver.servlet.context-path=$PREFIX"fiSAS_TEST_URL="http://localhost:7080${PREFIX}"DOMINO_SAS_ENTRY_PAGE="${PREFIX}start.html"sudo mkdir -p ${SASDS_SCRIPT_DIR}/html${PREFIX}sudo chown -R $DOMINO_USER_NAME:$DOMINO_USER_NAME ${SASDS_SCRIPT_DIR}/html${PREFIX}sudo sed -Ei "s#8888#$REVERSE_PROXY_PORT#g" ${SASDS_SCRIPT_DIR}/nginx.confsudo sed -E "s#SESSION_PATH#$PREFIX#g" ${SASDS_SCRIPT_DIR}/start.html > ${SASDS_SCRIPT_DIR}/html${DOMINO_SAS_ENTRY_PAGE} # This actually starts the SAS Studio workspacesudo -E SAS_LOGS_TO_DISK=$SAS_LOGS_TO_DISK _JAVA_OPTIONS="$_JAVA_OPTIONS $SAS_JAVA_OPTIONS" bash -c '/opt/sas/viya/home/bin/entrypoint &' # Wait for SAS Studio web server to come onlineuntil $(curl --output /dev/null --silent --head --fail $SAS_TEST_URL); do sleep 3; done # Start reverse proxy serversudo /usr/sbin/nginx -c ${SASDS_SCRIPT_DIR}/nginx.confecho -e "\n\nSAS Studio is now running\nTo get started, please visit ${DOMINO_USER_HOST}${DOMINO_SAS_ENTRY_PAGE} in your web browser.\n\n" # Infinite loop to prevent Workspace container from terminatingwhile true; do :; done;

Â© 2020 GitHub, Inc.TermsPrivacySecurityStatusHelpContact GitHubPricingAPITrainingBlogAbout


#!/usr/bin/env bashset -o errexit -o pipefail [[ -z $DOMINO_USER_NAME ]] && DOMINO_USER_NAME="domino"[[ -z $DOMINO_WORKING_DIR ]] && DOMINO_WORKING_DIR="/mnt"[[ -z $DOMINO_PROJECT_OWNER ]] && DOMINO_PROJECT_OWNER="domino"[[ -z $DOMINO_PROJECT_NAME ]] && DOMINO_PROJECT_NAME="domino"[[ -z $DOMINO_RUN_ID ]] && DOMINO_RUN_ID="1"[[ -z $DOMINO_USER_HOST ]] && DOMINO_USER_HOST="http://localhost"[[ -z $DOMINO_USE_SUBDOMAIN ]] && DOMINO_USE_SUBDOMAIN=false[[ -z $SAS_LOGS_TO_DISK ]] && SAS_LOGS_TO_DISK=true[[ -z $REVERSE_PROXY_PORT ]] && REVERSE_PROXY_PORT=8888 DOMINO_SAS_CONFIG_DIR="${DOMINO_WORKING_DIR}/sasconfig"DOMINO_SASSTUDIO_AUTOEXEC_FILE="${DOMINO_SAS_CONFIG_DIR}/sasstudio-autoexec.sas"DOMINO_SAS_SNIPPETS_DIR="${DOMINO_SAS_CONFIG_DIR}/snippets"DOMINO_SAS_TASKS_DIR="${DOMINO_SAS_CONFIG_DIR}/tasks"DOMINO_SAS_PREFERENCES_DIR="${DOMINO_SAS_CONFIG_DIR}/preferences"DOMINO_SAS_KEYBOARDSHORTCUTS_DIR="${DOMINO_SAS_CONFIG_DIR}/keyboardShortcuts"DOMINO_SAS_STATE_DIR="${DOMINO_SAS_CONFIG_DIR}/state"DOMINO_GIT_REPOS_PATH=/reposDOMINO_DATASETS_PATH=/domino/datasetsSAS_STUDIO_CONFIG_FILE=/opt/sas/viya/config/etc/sasstudio/default/init_usermods.propertiesSAS_AUTOEXEC_DIR="$HOME/.sasstudio5"SAS_STUDIO_AUTOEXEC_FILE="${SAS_AUTOEXEC_DIR}/.autoexec.sas"SAS_SHORTCUTS_DIR="$HOME/.sasstudio5"SAS_SHORTCUTS_FILE="${SAS_SHORTCUTS_DIR}/shortcuts.xml"SAS_SNIPPETS_DIR="$HOME/.sasstudio5/mySnippets"SAS_TASKS_DIR="$HOME/.sasstudio5/myTasks"SAS_PREFERENCES_DIR="$HOME/.sasstudio5/preferences"SAS_KEYBOARDSHORTCUTS_DIR="$HOME/.sasstudio5/keyboardShortcuts"SAS_STATE_DIR="$HOME/.sasstudio5/state"SAS_JAVA_OPTIONS="-Dserver.servlet.session.timeout=-1" # Prevent SAS Entrypoint script from starting Apache proxy serverAPACHE_CONF=/etc/httpd/conf/httpd.confAPACHE_PORT=8880sudo sed -Ei "s#Listen 80#Listen $APACHE_PORT#g" $APACHE_CONF # Set up Domino project to preserve SAS configuration filesmkdir -p "$DOMINO_SAS_CONFIG_DIR" "$DOMINO_SAS_SNIPPETS_DIR" "$DOMINO_SAS_TASKS_DIR" "$DOMINO_SAS_PREFERENCES_DIR" "$DOMINO_SAS_KEYBOARDSHORTCUTS_DIR" "$DOMINO_SAS_STATE_DIR" # Hack to ensure autoexec.sas can live in the Domino project folder.# This is needed to properly tie in autoexec.sas with SAS Studiomkdir -p "$SAS_AUTOEXEC_DIR"rm -rf "$SAS_STUDIO_AUTOEXEC_FILE"ln -s "$DOMINO_SASSTUDIO_AUTOEXEC_FILE" "$SAS_STUDIO_AUTOEXEC_FILE" # Hack to ensure SAS Studio "My Snippets" are preserved with the Domino project filesrm -rf "$SAS_SNIPPETS_DIR"ln -s "$DOMINO_SAS_SNIPPETS_DIR" "$SAS_SNIPPETS_DIR" # Hack to ensure SAS Studio "My Tasks" are preserved with the Domino project filesrm -rf "$SAS_TASKS_DIR"ln -s "$DOMINO_SAS_TASKS_DIR" "$SAS_TASKS_DIR" # Hack to ensure SAS Studio Preferences are preserved with the Domino project files[[ ! -d "$DOMINO_SAS_STATE_DIR" && -d "$SAS_STATE_DIR" ]] && cp -r "${SAS_STATE_DIR}/*" "${DOMINO_SAS_STATE_DIR}/"rm -rf "$SAS_STATE_DIR"ln -s "$DOMINO_SAS_STATE_DIR" "$SAS_STATE_DIR" # Hack to ensure SAS Studio state is preserved with the Domino project files[[ ! -d "$DOMINO_SAS_PREFERENCES_DIR" && -d "$SAS_PREFERENCES_DIR" ]] && cp -r "${SAS_PREFERENCES_DIR}/*" "${DOMINO_SAS_PREFERENCES_DIR}/"rm -rf "$SAS_PREFERENCES_DIR"ln -s "$DOMINO_SAS_PREFERENCES_DIR" "$SAS_PREFERENCES_DIR" # Hack to ensure SAS Studio Keyboard Shortcuts are preserved with the Domino project filesrm -rf "$SAS_KEYBOARDSHORTCUTS_DIR"ln -s "$DOMINO_SAS_KEYBOARDSHORTCUTS_DIR" "$SAS_KEYBOARDSHORTCUTS_DIR" # Configure SAS Studio folder shortcuts to show Domino Git repos and Datasets foldersSHORTCUTS_DOMINO_GIT_REPOS=""if [ -d "$DOMINO_GIT_REPOS_PATH" ]; then SHORTCUTS_DOMINO_GIT_REPOS=" <Shortcut type=\"disk\" name=\"Git Repos\" dir=\"$DOMINO_GIT_REPOS_PATH\" />"fi SHORTCUTS_DOMINO_DATASETS=""if [ -d "$DOMINO_DATASETS_PATH" ]; then SHORTCUTS_DOMINO_DATASETS=" <Shortcut type=\"disk\" name=\"Domino Datasets\" dir=\"$DOMINO_DATASETS_PATH\" />"fi SHORTCUTS_DOMINO_IMPORTS=""for DOMINO_IMPORT in `printenv | grep -e 'DOMINO_.*_WORKING_DIR' | tr '=' ' ' | awk '{print $1}'`; do DOMINO_IMPORT_DIR=${!DOMINO_IMPORT} DOMIMO_IMPORT_NAME=`echo "Import $DOMINO_IMPORT_DIR" | sed 's#/mnt/##g'` SHORTCUTS_DOMINO_IMPORTS=" <Shortcut type=\"disk\" name=\"$DOMIMO_IMPORT_NAME\" dir=\"$DOMINO_IMPORT_DIR\" />"done SHORTCUTS_HOME=" <Shortcut type=\"disk\" name=\"Home\" dir=\"$HOME\" />"SHORTCUTS_TMP=" <Shortcut type=\"disk\" name=\"Temp\" dir=\"/tmp\" />" SAS_SHORTCUTS="""<?xml version=\"1.0\" encoding=\"UTF-8\"?><Shortcuts>$SHORTCUTS_DOMINO_GIT_REPOS$SHORTCUTS_DOMINO_DATASETS$SHORTCUTS_DOMINO_IMPORTS$SHORTCUTS_HOME$SHORTCUTS_TMP</Shortcuts>"""mkdir -p $SAS_SHORTCUTS_DIRecho $SAS_SHORTCUTS > $SAS_SHORTCUTS_FILE # Configure SAS Studio options for DominoSAS_CONFIG_UPDATES="""sas.studio.basicUser=dominosas.studio.basicPassword=dominosas.studio.fileNavigationRoot=CUSTOMsas.studio.fileNavigationCustomRootPath=${DOMINO_WORKING_DIR}sas.studio.globalShortcutsPath=${SAS_SHORTCUTS_FILE}sas.commons.web.security.cors.allowedOrigins=*sas.commons.web.security.csrf.enable-csrf=falsesas.commons.web.security.content-security-policy-enabled=falsesas.commons.web.security.x-frame-options-enabled=falsesas.commons.web.security.x-content-type-options-enabled=falsesas.commons.web.security.x-xss-protection-enabled=false"""sudo sh -c "echo '$SAS_CONFIG_UPDATES' > $SAS_STUDIO_CONFIG_FILE" # Some configuration for Domino subdomains and revese proxy serverif $DOMINO_USE_SUBDOMAIN; then PREFIX="/SASStudio/" else PREFIX="/${DOMINO_PROJECT_OWNER}/${DOMINO_PROJECT_NAME}/notebookSession/${DOMINO_RUN_ID}/" SAS_JAVA_OPTIONS="$SAS_JAVA_OPTIONS -Dserver.servlet.context-path=$PREFIX"fiSAS_TEST_URL="http://localhost:7080${PREFIX}"DOMINO_SAS_ENTRY_PAGE="${PREFIX}start.html"sudo mkdir -p ${SASDS_SCRIPT_DIR}/html${PREFIX}sudo chown -R $DOMINO_USER_NAME:$DOMINO_USER_NAME ${SASDS_SCRIPT_DIR}/html${PREFIX}sudo sed -Ei "s#8888#$REVERSE_PROXY_PORT#g" ${SASDS_SCRIPT_DIR}/nginx.confsudo sed -E "s#SESSION_PATH#$PREFIX#g" ${SASDS_SCRIPT_DIR}/start.html > ${SASDS_SCRIPT_DIR}/html${DOMINO_SAS_ENTRY_PAGE} # This actually starts the SAS Studio workspacesudo -E SAS_LOGS_TO_DISK=$SAS_LOGS_TO_DISK _JAVA_OPTIONS="$_JAVA_OPTIONS $SAS_JAVA_OPTIONS" bash -c '/opt/sas/viya/home/bin/entrypoint &' # Wait for SAS Studio web server to come onlineuntil $(curl --output /dev/null --silent --head --fail $SAS_TEST_URL); do sleep 3; done # Start reverse proxy serversudo /usr/sbin/nginx -c ${SASDS_SCRIPT_DIR}/nginx.confecho -e "\n\nSAS Studio is now running\nTo get started, please visit ${DOMINO_USER_HOST}${DOMINO_SAS_ENTRY_PAGE} in your web browser.\n\n" # Infinite loop to prevent Workspace container from terminatingwhile true
m do :; done;

var class_script_stash_1_1_script =[ [ "Script", "class_script_stash_1_1_script.html#aa69b5997bfa5084852f4525e75503489", null ], [ "Script", "class_script_stash_1_1_script.html#ae515a33f5fe7127f66a006fd32285e51", null ], [ "AppendLine", "class_script_stash_1_1_script.html#aaf51788244af537d5388030d78a18dd0", null ], [ "FirstLineIndexWhere", "class_script_stash_1_1_script.html#a93384771a12523a586b985d4a031d7ca", null ], [ "InjectTokens", "class_script_stash_1_1_script.html#a66d20439b7ac389646d6cd2caa36e52b", null ], [ "InjectTokens", "class_script_stash_1_1_script.html#ab9940ba91997abff4cfd32f5f1b681d7", null ], [ "InjectTokens", "class_script_stash_1_1_script.html#a3cb0f501517d2e035f24b6b65c842ae3", null ], [ "InjectTokens", "class_script_stash_1_1_script.html#af399ce550d3c2a82cde50367b14a8e9f", null ], [ "InjectTokens", "class_script_stash_1_1_script.html#ac29b26849d3ed31d2213300b9274776b", null ], [ "InjectTokens", "class_script_stash_1_1_script.html#abf2a927d5f923c97996990718ed5b5ef", null ], [ "InsertLineAtIndex", "class_script_stash_1_1_script.html#aec87daaad1bed301b846d32227bb30d9", null ], [ "InsertLineOnFirstWhere", "class_script_stash_1_1_script.html#ac6b3ec4b068037e622098fdf1a43728c", null ], [ "InsertLineOnLastWhere", "class_script_stash_1_1_script.html#a95a8bd8777c01cfecd57baab69b1ba68", null ], [ "InsertLineWhere", "class_script_stash_1_1_script.html#ae95d4c49dde7d16c41e0c5e9489f12c8", null ], [ "LastLineIndexWhere", "class_script_stash_1_1_script.html#aae5c32d8f059395c379ddc8cec4913f4", null ], [ "LinesIndexWhere", "class_script_stash_1_1_script.html#a9fe86b22d6b42929755404095ed5ad6d", null ], [ "Reload", "class_script_stash_1_1_script.html#ac4ed6d8c900a1ec036a44321f8935f47", null ], [ "Reload", "class_script_stash_1_1_script.html#aa0001877b21bb285c48b988f5982931d", null ], [ "RemoveLineAtIndex", "class_script_stash_1_1_script.html#a55ef5f51bc5a4ba6485734f9f2c388b6", null ], [ "RemoveLineOnFirstWhere", "class_script_stash_1_1_script.html#ad188638bbccf5778ee3ce5ecbaa1bf9e", null ], [ "RemoveLineOnLastWhere", "class_script_stash_1_1_script.html#ab1d7a04fc9fff07b74e422af0828b226", null ], [ "RemoveLineWhere", "class_script_stash_1_1_script.html#ac7576339a1034d5678c6edb406f8755c", null ], [ "ReplaceLineAtIndex", "class_script_stash_1_1_script.html#aba499d4246d39b8e1a570d2c451452b3", null ], [ "ReplaceLineOnFirstWhere", "class_script_stash_1_1_script.html#a9a94b80950a8620c8b2d7053e2633ba5", null ], [ "ReplaceLineOnLastWhere", "class_script_stash_1_1_script.html#a4db77fabb60230ee64d8830174714e54", null ], [ "ReplaceLineWhere", "class_script_stash_1_1_script.html#ae6b56ef81cb5e9a9232fd04992fb0c9e", null ], [ "Save", "class_script_stash_1_1_script.html#a7d4bf665a60f24c8941b47423c138e56", null ], [ "SaveAs", "class_script_stash_1_1_script.html#a924b4d8dd2cf38ee55094fc9f8fe9101", null ], [ "FileDirectory", "class_script_stash_1_1_script.html#a1d529b337add4ebc4743c2a467febfa8", null ], [ "FileExtension", "class_script_stash_1_1_script.html#a13dc756c2ee7bca5c6ad0706687f3a87", null ], [ "FileName", "class_script_stash_1_1_script.html#a85b41bdf0d7eaf0daa5add47b62f644c", null ], [ "FilePath", "class_script_stash_1_1_script.html#a0727c6ada9b285d4b8b1c72ca35609cf", null ], [ "LineCount", "class_script_stash_1_1_script.html#a6b93667cc57235e3784de864d1130b21", null ], [ "Lines", "class_script_stash_1_1_script.html#a1e4abd29106b220845f4c7844626b855", null ], [ "Pattern", "class_script_stash_1_1_script.html#a35d298ef8ec4dfa1c5eeb652e9ab5a61", null ], [ "Text", "class_script_stash_1_1_script.html#a1c07a6c5044fa57e2f01f3e865ec5cc2", null ], [ "this[int index]", "class_script_stash_1_1_script.html#ac09d5fb69861945691846f6bcbef0e3b", null ], [ "Tokens", "class_script_stash_1_1_script.html#ad7fe335e5e0f26c77868fbcd9ff8a7be", null ]];
